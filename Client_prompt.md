Crea el código del cliente de esta aplicación en base a lo siguiente:

FUNCIONAMIENTO GENERAL DE LA APP:

- Es para usuarios registrados de la empresa, no es una página de acceso público.
- Los usuarios normales (jefes de obra) lo usarán a diario y normalmente con el móvil, por lo que va a ser una PWA, mientras que las operaciones de consultas que harán los administradores serán casi todo en PC, pero una vez por semana o menos.
  VISTA CONTROL HORARIO
- Un jefe de obra inicia sesión y la app salta a la vista de control horario. Desde ahí selecciona una de sus obras y una fecha (generalmente el día de hoy). Ahí añade registros horarios, al añadir selecciona una empresa, luego uno de los trabajadores (o equipos) de esa empresa, luego selecciona la hora de entrada y valida el registro. Luego meterá la hora de salida. El programa muestra en cada fila el factor de corrección de la regla que aplica a esa empresa en esta obra y cuando se cierra el registro (con hora de salida) se muestran las horas de la jornada laboral.
- Los trabajadores (resources) de la empresa principal, no se les proporciona hora de entrada y salida, se lee el horario activo de main_company_schedules y son los datos que se aplican. Solo se selecciona al trabajador y se le da a algún botón para validarlo (o eliminar el registro)
- Además, en la parte baja de la tabla puede añadir subcontratas para la listería del día, donde sólo selecciona la empresa y el nº de trabajadores que han venido.
- Habrá un menu que permita cambiar a otras vistas (desplegable lateral en PC y dese arriba en móvil).
  VISTA EMPRESAS
- En la vista de empresas, se pueden crear nuevas empresas de recursos (companies), modificarlas o seleccionarlas y añadir trabajadores u otros recursos. También se podrá modificar los nombres de los trabajadores. De manera sencilla también se tiene que poder añadir o modificar las categorías propias de la empresa.
- También se podrán crear empresas subcontratas. No creo que se necesite una vista exclusiva, podría estar en la parte baja de esta sección de empresas. Desde esta vista tendría que haber un enlace para saltar a la configuració de reglas horarias para cada obra de las empresas.
  VISTA OBRAS
- Esta vista será la de la obra. Se puede seleccionar una obra y luego las empresa de recursos. Con una empresa seleccionada se muestra la regla actual de aplicación y las anteriores. Se podrán crear nuevas. La idea es no tener libertad plena. Se crea la regla y se dice desde cuando aplica (como muy atrás desde el inicio de la obra), y aplica hasta el infinito. Luego se podrá insertar un cambio, que a partir de tal fecha se aplique una regla nueva y así sucesivamente. Se puede modificar el factor corrector de cualquiera de los periodos (se deberían mostrar uno detrás de otro como una barra de segmentos). También se puede desplazar una fecha, lo que afectará a dos reglas generalmente. Cualquier cambio de un corrector o fecha debería indicar cuántos registros de control horario se ven afectados por el cambio.
  VISTA CONSULTAS
- Esta vista se usará generalmente desde el PC, pero ha de ser viable con el móvil. Se meten datos y devuelve una tabla de resultados. Las consultas normales serán, horas de una empresa en una obra en un mes (o periodo X), deberá venir también un resumen con totales por categoría. Esta consulta se podría restringir a un recurso de esta empresa. Menos habitual, pero podría hacerse para todas mis obras también.
  VISTAS AISLADAS
- Estas vistas realizan una función concreta y en realidad están aisladas del funcionamiento general de la aplicación. Tenemos la de login, o la de forgot pasword, meto el código y reseteo, la de editar mi usuario donde cambio el nombre o la contraseña.

ARQUITECTURA:

- El cliente será pues una PWA en vanilla JavaScript, nada de React, etc.
- En tema de estilos también vanilla CSS, con multiples archivos importados en uno general, nada de Tailwind, etc.
- La idea es definir de manera estructurada los web components base y reutilizarlos en las vistas.
- En realidad es una SPA. Debería ser una arquitectura MV orientada a eventos, con una clase appState heredando de EventTarget que controle todo el estado de la aplicación (vista actual, datos en las distintas secciones de las vistas, usuario activo, datos de sesiones previas, etc.)
- Por lo que es una mono-vista real con navegación por estado, no por rutas, con las vistas desacopladas y un estado central observable y cero lógica de negocio en las vistas.
- Las vistas escuchan cambios y renderizan lo necesario. No saben de API.
- Los controladores validan y orquesatan las llamadas. Actualizan el estado a través de los métodos de appState, que a su vez despacha eventos para actualizar las vistas.
- Por lo tanto no se necesita un router pesado. Para urls haremos history.pushState y deep linking solo en vistas principales.
- Me gusta que los componentes sean clases y usar la herencia para tipos similares o componentes extendidos. A su vez, también me gusta que los contenedores de las vistas sean clases con elementos comunes como generar el markup, o cada item de un markup en una lista, métodos para renderizar, para poner en un espacio designado con una propiedad un spinner en lo que llegan los datos y también con otra propiedad designar otro espacio reservado para mostrar mensajes de error o de información al usuario. Muchas de estas funciones se pueden recopilar en una clase padre. Los constructores pueden cargar los templates HTML de los componentes y luego los métodos de markup o render esperar a los datos para colocarlos en los placeholders. (Web components / clases UI propias)
- También me gusta un aspecto de app moderna con control sobre el DOM para efectos y detalles visuales (cosa que se maneja mejor en vanilla JS que en React). P.ej. el icono '+' de añadir un registro una vez selecionada la empresa rota y se convierte en una 'x' para eliminarlo, transiciones del menú flotante, control sobre iconos SVG, etc.
- Se pueden usar las URLs para vistas aisladas, como la de hacer login, o la de configuración del usuario para cambiar el nombre, la contraseña, etc. En vistas que en realidad no interactuen con el estado real de la aplicación, vistas que se muestran, se realiza una función aislada y vuelve a la app.

APARIENCIA

- Un control que va a ser muy útil será un input, textbox o select box, con las esquinas redondeadas, a su izquierda, fuera, un icono que represente el concepto, y a la derecha, pero dentro del input otro icono para hacer check, ver o mostrar contraseña, desplegar el select box, etc.
- Estaría bien que el menú (en lateral o arriba) se despliegue suave dinámicamente. Lo mismo podría pasar con las cajas de selección que salen hacia abajo en los select box o para búsquedas con preview de resultados.

VISTAS
LOGIN
Si se accede a la app y no hay token aparece la vista login. Arriba una barra con el nombre de la app "JMI Tracker v.1.0" a la izquierda y un espacio reservado para el icono de menú a la derecha. Debajo y centrado el logo de JMI. Debajo, centrados, dos inputs con sus iconos y placeholders para introducir email y contraseña. Debajo un texto con un enlace de 'olvidó contraseña?' y debajo, del mismo ancho todo, un botón para hacer login. Debajo, un box invisible (mismo background etc.) para mostrar mensajes de error o de mail enviado, etc. En la parte de abajo del todo de la app debería haber otra barra con un copyright '2026 Kuantik Software', pequeño.
RESET PASSWORD
Misma estructura, pero aquí irá un mensaje de introduce el código y luego debajo 6 boxes grandes para meter el código de 6 dígitos. Una vez rellenos, debajo se introduce la contraseña y un campo de confirmación de contraseña y un botón de enviar.

MENU PRINCIPAL APP
Toda la app debería tener arriba una barra replegada con el nombre de la app y una flechita de arrastra para abajo. Si se arrastra deberían salir las secciones: control horario, empresas, obras, estadísticas. Cada una es un icono con un texto debajo. Los 4 iconos estarán separados ingualmente en horizontal y resaltado el de la vista actual. Si no se hace nada, se repliega.

VISTA PRINCIPAL CONTROL HORARIO
En la parte superior, centrados hay dos elementos más grandes, uno para seleccionar la obra, que es un desplegable con sus iconos, y otro debajo para seleccionar la fecha (por defecto hoy) que despliega un calendario. Debajo habrá una tabla que ocupe todo el ancho y todo el alto, y más de alto si fuera necesario, donde se podría hacer scroll para abajo. La tabla está dividida en dos secciones con un separador horizontal sutil. La parte superior es control horario. Aquí se añadirán los row items de la siguiente manera: Si no hay nada, el row item tiene un icono add (+) a la iquierda. Se pincha y despliega las empresas, se selecciona y se queda en el select box a la derecha del icono, que gira para convertirse en delete (x), se abre otro selector para los trabajadores o recursos, se selecciona y se queda a la derecha de la empresa. Los trabajadores en el selector dejan un espacio pequeño a la izquierda para un icono que marca si está de vacaciones, de baja o ya está en otra obra hoy. Una vez seleccionado, sale un cuadro para la hora de inicio. En móvil estaría bien que fuera un deslizable vertical para horas (empezando 08 p. defecto, p.ej.) y otro para minutos de 5 en 5 (de 00 a 55). A la derecha de la hora, saldrá un icono check que si le das queda marcado como check-done y crea el registro. A la derecha de este icono pequeño está la hora de salida, que estará sombreada y sin horas marcadas, hasta que el usuario toque y la seleccione. A la derecha sale el número de day_correction de la regla que se aplica para esta empresa y obra, un texto pequeño sin recuadros ni nada, y a la derecha, al final, saldrá un número más grande con las horas de la jornada cuando end_time exista. Podría ser la hora 7, 8 más grande y los minutos 15 30 etc. mucho más pequeños pegados a la derecha. El row para la empresa principal es igual, solo que las horas de entrada y salida se rellenan automáticamente y no se pueden modificar (un leve sombreado) así que el registro se crea con el check simplemente. La parte superior de la tabla se dimensiona en vertica para que entren todas sus filas y un pequeño espacio en el separador. La parte inferior es muy sencilla. Mismo botón de add (+) solo que aquí salen las empresas de la tabla de contractors y a la derecha un cuadro para meter el número de trabajadores. El meter el número es lo que crea el registro. Luego ya sólo puedes o modificar el nº o borrar el registro con el botón girado (x). Cuando al principio se selecciona una obra y una fecha, se cargan los registros que ya existan, si no hay ninguno sería interesante que se cargaran provisionalmente los del último día en los que haya registros (al menos hasta el start_time) esperando a que el usuario pinche los checks y los confirme.

VISTA EMPRESAS
Al final son similares todas las vistas. En empresas creas o seleccionas y al final hay una pequeña tabla debajo con los trabajadores, con otra parte inferior para las categorías. Puedes hacer una propuesta de cómo sería adecuado el layout. El usuario puede crear, modificar o desactivar empresas y trabajadores. Estaría bien un icono de la tabla para hacer toggle en ocultar registros inactivos. Tambien puede crear y modificar categorías específicas de la empresa (no las generales). A la hora de asignar la categoría a un trabajador, en el selector saldrán primero las generales (que son 3 o 4) y luego las de la empresa.

VISTA OBRAS
Los usuarios no pueden crear obras. Las crea el admin que además es el que asigna a los usuarios a sus obras. Por ahora nos podemos centrar en la vista de usuarios. Aquí solo seleccionas obras y luego debajo puedes seleccionar las empresas (las de companies, no de contractors). Aquí se tiene que poder crear una regla si no la hay (que no es más que un corrector de minutos al sumar end_time - start_time para calcular la jornada, aplicado sobre un periodo). Siempre la regla última (o única) tiene valid_to = null para que siga vigente indefinidamente. Pero se puede crear un cambio de regla, nueva fecha y a partir de ahí se aplica la nueva, pero se mantiene la otra en el histórico. También tiene que haber una posibilidad de mover una fecha entre dos reglas, por ejemplo, ahora la 2ª regla se aplica dos días antes. No voy a permitir huecos entre reglas, si se quiere eliminar el ajuste en un periodo, se crea una regla con correction = 0 y listo. Siendo prácticos la mayoría de empresas tendrán una regla en una obra. Como mucho tres o cuatro a lo largo de los meses de duración de la misma. Habría que tener un sistema para visualizar este concepto. Puedes hacer una propuesta. Puede ser una línea horizontal con checkpoints en los cambios de regla con la fecha y el corrector puesto en el intervalo, o también como elementos apilados en vertical. Lo que tengo claro es que la escala real del tiempo no es muy relevante en la visualización de este tema.

VISTA ESTADÍSTICAS
Esta no la tengo muy clara todavía pero al final sigue una estructura muy similar a las demás. En la parte superior están los campos de la consulta, que seleccionas, marcas o no si se aplicará en el filtro, etc. Y en la parte inferior estará una tabla para los resultados. Las filas en la visualización de la app tendrán que tener para los distintos casos un número de campos muy reducido, sólo lo más relevante. Los usuarios al final van a consultar registros horarios (time_entries) y resultados de suma de las filas y los datos de asistencia (contractor_attendance) de las subcontratas. Nada más. Para los admins es diferente, pues tiene que poder gestionar toda la app y además recibir otro tipo de información. Los usuarios sólo pueden consultar registros vinculados con sus obras, pero los admins podrían hacer consultas más generales, a parte tendrán que poder obtener información de bajas y vacaciones en ciertos periodos, tienen que poder revisar categorías, empresas, etc. para editar o arreglar problemas donde los usuarios no tengan permisos. Esto está pensado (tanto a nivel user como admin) que en el futuro esas tablas se puedan exportar a excel en un formato concreto y descargarlas.
